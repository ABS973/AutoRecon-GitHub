name: Automated Nmap Scan

on:
  workflow_dispatch:
  schedule:
    - cron: "0 0 * * 0"  # every Sunday at midnight

jobs:
  scan:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout Repository
        uses: actions/checkout@v3

      - name: Install Python dependencies
        run: pip install -r requirements.txt

      - name: Install Nmap
        run: sudo apt-get update --allow-releaseinfo-change && sudo apt-get install -y nmap

      - name: Run Scanner
        run: python3 scanner.py -t scanme.nmap.org

      - name: Upload Scan Reports
        uses: actions/upload-artifact@v3
        with:
          name: scan-reports
          path: scan_report_*.{txt,html}

      - name: Commit Reports (optional)
        run: |
          git config --global user.name "GitHub Actions"
          git config --global user.email "actions@github.com"
          git add scan_report_*.{txt,html}
          git commit -m "Add latest scan reports" || echo "No changes to commit"
          git push